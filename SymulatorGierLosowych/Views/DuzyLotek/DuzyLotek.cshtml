
@{
    ViewBag.Title = "DuzyLotek";
    Layout = "~/Views/Shared/_StoredLayout.cshtml";
}

<script src="~/Scripts/SeparationOfNumbersByATab.js"></script>
<script src="~/Scripts/ReturnExceedingNumbersToTable.js"></script>
<script src="~/Scripts/ClickedCouponNumber.js"></script>
<script src="~/Scripts/RenderCoupn.js"></script>

<h2>DuzyLotek</h2>

    Podaj ilość losów, nie może być więcej niż 100<br>

    <input type="number" placeholder="1" min="0" max="100" name="playslip" id="numbers">
    <input type="button" onclick="GetNumberOfPlayslip('button')" name="button" value="Akceptuj">
    <input type="button" onclick="GetNumberOfPlayslip('+')" name="+" value="+">
    <input type="button" onclick="GetNumberOfPlayslip('-')" name="-" value="-">
    <div id="id_number"></div>
    <br /><br />
    <div id="max"></div>
    <br /><br />
    <div id="res"></div>
    <br />
    <input type="button" onclick="GetNumbers()" name="getnumbers" value="getnumbers">
    <br />
    Wylosowane liczby
    <div id="dat"></div>
    <br />

    <script type="text/javascript">

        let count = 1;
        count = $("#numbers").val();
        let quantity = "";
        var numbersDiv = $("#numbers");
        var resDiv = $("#res");

        function GetNumberOfPlayslip(input)
        {
            if (input == "+")
            {
                count++;
                RenderCoupon(count,numbersDiv,resDiv);
                return;
            }
            if (input == "-")
            {
                count--;
                RenderCoupon(count, numbersDiv, resDiv);
                return;
            }

            if (input == "button")
            {
                count = $("#numbers").val();
                RenderCoupon(count, numbersDiv, resDiv);
                return;
            }
        }

        let tabOfDivIndexs = [];
        let resTable = [];
        let maxNumbersOnTheCoupon = 6;
        let changeColor = false;
        // Do tej tablicy zapisuję te kupony w których już wykorzystano maksymalną liczbę klikniętych numerów
        let couponLimitTable = [];
        let couponsQuantity;

        // 'body' jest potrzebne dla "zobaczenia" elementów dynamicznie załadowanych
        $('body').on('click', '.number', function ()
        {
            console.clear();

            // Zczytanie wartości Id zaznaczonego <div> 
            var id = $(this).attr('id');
            $('#id_number').html('Id wynosi: ' + id);

            if (couponLimitTable[ClickedCouponNumber(id)] != true) {

                if (couponsQuantity != null) {
                    var message = "";
                    for (var j = 0; j <= couponsQuantity.length; j++) {
                        console.log('analiza : j = ' + j + ' tablica = ' + couponsQuantity[j]);
                        if (couponsQuantity[j] == maxNumbersOnTheCoupon) {
                            message = message + 'W losie: ' + j + ' - jest już maksymalna ilość liczb! <br />';
                            couponLimitTable[j] = true;
                            $(this).css("background-color", "#ffffff");
                            $('#' + j).css("background-color", "#fff6f6");
                        }
                        $('#max').html(message);
                    }
                }
            }

            // Dodanie zaznaczonych liczb do tablicy
            // zabezpieczenie przed powielaniem się wartości w tablicy (opakować później w funkcję)
            if (tabOfDivIndexs.indexOf(id) == -1)
            {
                // Nie pozwoli by dodać nową liczbę, jeżeli ilość wprowadzonych na kuponie przekroczy maksymalną dopuszczalną
                if (couponLimitTable[ClickedCouponNumber(id)] != true)
                {
                    tabOfDivIndexs.push(id);

                    // Szukanie ilości wprowadzonych liczb w danym losie
                    console.log('tablica 1 - numery: ' + SeparationOfNumbersByATab(tabOfDivIndexs, 1));
                    console.log('tablica 2 - kupony: ' + SeparationOfNumbersByATab(tabOfDivIndexs, 2));

                    // Rozdzielenie numeru losu od numeru na losie "|" i przypisanie wartości do tablic
                    resTable = SeparationOfNumbersByATab(tabOfDivIndexs, 2);
                    console.log('res table : ' + resTable);

                    // CSS - zaznaczenie na kolor niebieski elementu
                    console.log('couponlimit table - ' + couponLimitTable);
                    if (changeColor == true) {
                        $(this).css("background-color", "#ffbf80");
                        changeColor = false;
                    } else if (changeColor == false) {
                        $(this).css("background-color", "#b3d7ff");
                        changeColor = true;
                    }
                }
            } else if (tabOfDivIndexs.indexOf(id) == 1)
            {
                return;
            }

            console.log('Id równa się = ' + id);
            console.log('tablica = ' + tabOfDivIndexs);
            console.log('res table 2 : ' + resTable);

            couponsQuantity = ReturnExceedingNumbersToTable(resTable);
            console.log('coupons quantity : ' + couponsQuantity);

        });

    function GetNumbers() {
        $.ajax({
            type: "GET",
            url: "@Url.Action("GetNumbers", "DuzyLotek")",
            success:function(data)
            {
                console.log('wielkosc tablicy ' + data.length);
                console.log('tablica ' + data);
                var result = "";
                var dLenght = data.length;

                for (var i = 0; i < dLenght; i++)
                {
                    if (i == dLenght - 1)
                    {
                        result = result + data[i];
                        break;
                    }
                    result = result + data[i] + " , ";
                }

                $('#dat').html(result);
                console.log(result);
            },
            error: function (error) {
                $('#dat').html("jakiś błąd");
            }
        });
    }

    let zmienna = "jakiś tekst";
    $("#myDiv").css("border", "3px solid red");
    $("#myDiv").html(zmienna);

    $("#dat").click(function () {
        $("#myDiv").html(games);
    });
</script>
